(()=>{"use strict";var e=document.querySelector(".popup_type_image"),t=(e.querySelector(".popup__fig-caption"),e.querySelector(".popup__image"),document.querySelector(".popup_type_profile")),r=document.querySelector(".popup_type_place"),s=t.querySelector(".popup__form"),o=(r.querySelector(".popup__form"),document.querySelector(".button_type_edit-info")),i=document.querySelector(".button_type_add-card"),n=s.querySelector(".popup__input_type_name"),a=s.querySelector(".popup__input_type_job"),l={};class p{constructor(e){this._popup=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this),this._closeButton=this._popup.querySelector(".button_type_close-popup")}open(){this._popup.classList.add("popup_open"),document.addEventListener("keyup",this._handleEscClose)}close(){this._popup.classList.remove("popup_open"),document.removeEventListener("keyup",this._handleEscClose)}_handleEscClose(e){27===e.keyCode&&this.close()}setEventListeners(){this._closeButton.addEventListener("click",(()=>this.close())),this._popup.addEventListener("mousedown",(e=>{e.target===e.currentTarget&&this.close()}))}}class c extends p{constructor(e,t){super(e),this._submitFormCallback=t,this._popupForm=this._popup.querySelector(".popup__form"),this._inputs=[...this._popupForm.querySelectorAll(".popup__input")],this._values={}}_getInputValues(){return this._inputs.forEach((e=>{this._values[e.name]=e.value})),this._values}setEventListeners(){super.setEventListeners(),this._popupForm.addEventListener("submit",(()=>{this._submitFormCallback(this._getInputValues())}))}close(){super.close(),this._popupForm.reset()}}class _{constructor(e,t){this._form=t,this._errorClass=e.errorClass,this._formSelector=e.formSelector,this._inputSelector=e.inputSelector,this._inputErrorClass=e.inputErrorClass,this._popupErrorSelector=e.popupErrorSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._submitButtonSelector=e.submitButtonSelector,this._buttonSubmit=this._form.querySelector(this._submitButtonSelector),this._inputList=this._form.querySelectorAll(this._inputSelector)}_disableSubmitButton(){this._buttonSubmit.setAttribute("disabled",""),this._buttonSubmit.classList.add(this._inactiveButtonClass)}_activateButton(){this._buttonSubmit.removeAttribute("disabled"),this._buttonSubmit.classList.remove(this._inactiveButtonClass)}_showError(e,t){e.classList.add(this._inputErrorClass),t.classList.add(this._errorClass),t.textContent=e.validationMessage}_hideError(e,t){e.classList.remove(this._inputErrorClass),t.classList.remove(this._errorClass),t.textContent=""}_errorHideWhenOpen(){this._inputList.forEach((e=>{var t=this._form.querySelector(".".concat(e.id,"-error"));this._hideError(e,t)}))}_toggleButtonError(){this._form.checkValidity()?this._activateButton():this._disableSubmitButton()}_isValid(e){var t=this._form.querySelector(".".concat(e.id,"-error"));e.validity.valid?this._hideError(e,t):this._showError(e,t)}_setEventListeners(){this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._isValid(e),this._toggleButtonError()}))}))}_setOpenButtonListeners(){var e=document.querySelector(".".concat(this._form.id,"-button"));e&&e.addEventListener("click",(()=>{this._toggleButtonError(),this._errorHideWhenOpen()}))}enableValidation(){this._setEventListeners(),this._setOpenButtonListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._disableSubmitButton()}))}}class u{constructor(e,t,r){this._name=e.name,this._link=e.link,this._templateElementSelector=t,this._cardTemplate=document.querySelector(this._templateElementSelector).content.querySelector(".card"),this._handleCardClick=r}_fillCard(){this._cardCityName.textContent=this._name,this._cardImage.src=this._link,this._cardImage.alt=this._name}_likeCard(){this._likeCardButton.classList.toggle("card__like-button_active")}_deleteCard(){this._cardElement.remove(),this._cardElement=null}_setEventListeners(){this._likeCardButton.addEventListener("click",(()=>this._likeCard())),this._deleteCardButton.addEventListener("click",(()=>this._deleteCard())),this._cardImage.addEventListener("click",(()=>this._handleCardClick()))}generateCard(){return this._cardElement=this._cardTemplate.cloneNode("true"),this._cardImage=this._cardElement.querySelector(".card__image"),this._cardCityName=this._cardElement.querySelector(".card__city"),this._likeCardButton=this._cardElement.querySelector(".card__like-button"),this._deleteCardButton=this._cardElement.querySelector(".card__delete-button"),this._fillCard(),this._setEventListeners(),this._cardElement}}function d(e){return new u(e,".card-template",(()=>{m.open(e.link,e.name)})).generateCard()}o.addEventListener("click",(()=>{v.open();var e=S.getUserInfo(),t=e.name,r=e.job;n.value=t,a.value=r})),i.addEventListener("click",(()=>{E.open()}));var h=new class{constructor(e,t){var r=e.items,s=e.renderer;this._itemsList=r,this._renderer=s,this._container=document.querySelector(t)}renderItems(){this._itemsList.forEach((e=>{this._renderer(e,this._container)}))}addItem(e){this._container.prepend(e)}}({items:[{name:"Архыз",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg"},{name:"Челябинская область",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg"},{name:"Иваново",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg"},{name:"Камчатка",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg"},{name:"Холмогорский район",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg"},{name:"Байкал",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg"}],renderer:function(e,t){var r=d(e);h.addItem(r)}},".cards__list"),m=new class extends p{constructor(e){super(e),this._image=this._popup.querySelector(".popup__image"),this._caption=this._popup.querySelector(".popup__fig-caption")}open(e,t){super.open(),this._image.src=e,this._caption.textContent=t,this._image.alt=t}}(".popup_type_image"),v=new c(".popup_type_profile",(function(e){var t=e.name,r=e.job;S.setUserInfo(t,r),v.close()})),E=new c(".popup_type_place",(function(e){var t=d({name:e["place-name"],link:e.link});h.addItem(t),E.close()}));m.setEventListeners(),v.setEventListeners(),E.setEventListeners(),h.renderItems();var y,S=new class{constructor(e){var t=e.nameElementSelector,r=e.jobElementSelector;this._nameElement=document.querySelector(t),this._jobElement=document.querySelector(r)}getUserInfo(){return{name:this._nameElement.textContent,job:this._jobElement.textContent}}setUserInfo(e,t){this._nameElement.textContent=e,this._jobElement.textContent=t}}({nameElementSelector:".profile__name",jobElementSelector:".profile__description"});y={formSelector:".popup__form",inputSelector:".popup__input",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible",submitButtonSelector:".button_type_submit",inactiveButtonClass:"button_type_submit-inactive",buttonOpenProfileSelector:".button_type_edit-info",buttonOpenPlaceSelector:".button_type_add-card",popupErrorSelector:".popup__error"},Array.from(document.querySelectorAll(y.formSelector)).forEach((e=>{var t=new _(y,e),r=e.getAttribute("name");l[r]=t,t.enableValidation()}))})();